(function(a){a.fn.editableSet=function(c){var b=a.extend({},a.fn.editableSet.defaults,c),d=function(e){e.editing=!1;a.isFunction(b.onSave)&&b.onSave.call(e);var c=a("form",e),d=c.attr("action");b.dataType==="json"&&(d+=".json");c=b.globalSave?a("form",".editable").serialize():c.serialize();a.put(d,c,function(c,d){c=a.parseJSON(c)?a.parseJSON(c):c;b.globalSave?a.each(a(".editable"),function(b,c){a(c).html(a.fn.editableSet.globals.reversions[b]).removeClass("active");c.editing=!1}):(a(e).html(e.revert),
a(e).removeClass("active"));var f;b.globalSave?a.each(a(".editable"),function(d,g){f=a("span[data-name]",g);a.isFunction(b.repopulate)&&b.repopulate.call(e,f,c,b)}):(f=a("span[data-name]",e),a.isFunction(b.repopulate)&&b.repopulate.call(e,f,c,b));a.isFunction(b.afterSave)&&b.afterSave.call(e,c,d)},b.dataType,function(c,d){e.editing=!0;a(":input",e).attr("disabled",!1);a.isFunction(b.onError)&&b.onError.call(e,c,d)})},g=function(c){c.editing=!1;a(c).html(c.revert).removeClass("active");a.isFunction(b.onCancel)&&
b.onCancel.call(c)};return this.each(function(){var c=this;a(c).bind(b.event,function(f){f.preventDefault();f.stopPropagation();if(!c.editing){c.editing=!0;c.revert=a(c).html();if(a(this).attr("rel"))b.action=a(this).attr("rel");b.globalSave&&a.each(a(".editable"),function(b,c){a.fn.editableSet.globals.reversions.push(a(c).html())});a.isFunction(b.beforeLoad)&&b.beforeLoad.call(c);a(c).wrapInner(a("<form />",{action:b.action,method:"POST"})).addClass("active");b.titleElement&&a(b.titleElement,c).insertBefore(a("form",
c));f=b.titleElement&&a(b.titleElement,c).length>0?a(b.titleElement,c):a("form",c);f.append(a("<input />",{type:"submit",value:"Save",click:function(){d(c);a(":input",c).attr("disabled",!0);return!1}}).addClass("form_submit"));f.append(a("<input />",{type:"button",value:"Cancel",click:function(){g(c);a(":input",c).attr("disabled",!0);return!1}}).addClass("form_cancel"));f=a("span[data-name]",c);a.each(f,function(b,c){var d={};a.each(c.attributes,function(a){d[c.attributes[a].name]=c.attributes[a].value});
d.value=a(c).html();d["data-type"]=d["data-type"]||"text";var f=d["data-type"];a.editableSet.types[f]&&a.editableSet.types[f].element(c,d)});a.isFunction(b.afterLoad)&&b.afterLoad.call(c)}});a(window).unbind(".editableSet");a(window).bind("keydown.editableSet",function(a){if(a.keyCode==83&&(a.ctrlKey||a.metaKey))a.preventDefault(),d(c)});a(window).bind("keydown.editableSet",function(a){a.keyCode==27&&(a.preventDefault(),g(c))})})};a.fn.editableSet.attributor=function(c,b){a.each(b,function(a,b){var d=
/^data-/.test(a)?a.substr(5):a;c[0].setAttribute(d,b)});var d=b["data-prompt"];d&&c.prepend(a("<option />",{value:"",text:d}));return c};a.fn.editableSet.extractTextAndValue=function(a,b){var d={};a.constructor===Array?a[0].constructor===Array?(d.value=a[b][1],d.text=a[b][0]):(d.value=a[b],d.text=a[b]):(d.value=b,d.text=a[b]);return d};a.editableSet={types:{text:{element:function(c,b){var d=a.fn.editableSet.attributor(a("<input />"),b);a(c).replaceWith(d)}},email:{element:function(c,b){a.editableSet.types.text.element(c,
b)}},url:{element:function(c,b){a.editableSet.types.text.element(c,b)}},number:{element:function(c,b){a.editableSet.types.text.element(c,b)}},range:{element:function(c,b){a.editableSet.types.text.element(c,b)}},hidden:{element:function(c,b){a.editableSet.types.text.element(c,b)}},textarea:{element:function(c,b){delete b["data-type"];var d=a.fn.editableSet.attributor(a("<textarea />"),b);d.val(a.htmlDecode(b.value.replace(/<br.*?>/ig,"\r\n")));a(c).replaceWith(d)}},checkbox:{element:function(c,b){b["data-checked_value"]=
b["data-checked_value"]||"true";b["data-unchecked_value"]=b["data-unchecked_value"]||"false";b.value===b["data-checked_value"]&&(b["data-checked"]=!0);b.value=b["data-checked_value"];var d=a.fn.editableSet.attributor(a("<input />"),b);a(c).replaceWith(d);a("<input />",{type:"hidden",value:b["data-unchecked_value"],name:b["data-name"]}).insertBefore(d)}},select:{element:function(c,b){var d=JSON.parse(b["data-options"]),g=b.value;delete b["data-type"];delete b.value;delete b["data-options"];var e=a.fn.editableSet.attributor(a("<select />"),
b);(function(){for(var b in d){var c=a.fn.editableSet.extractTextAndValue(d,b);a("<option />",{value:c.value,text:c.text}).appendTo(e)}})();a(c).replaceWith(e);a('option[text="'+g+'"]',e).attr("selected",!0);a('option[value="'+g+'"]',e).attr("selected",!0)}},radio:{element:function(c,b){var d=JSON.parse(b["data-options"]).reverse();delete b["data-options"];var g=b.value,e=b["data-name"].replace(/\[|\]/g,"_");(function(){for(var f in d){var h=a.fn.editableSet.extractTextAndValue(d,f);b.value=h.value;
b.id=e+h.value.split("").join("").replace(/\s/,"_").toLowerCase();var j=a.fn.editableSet.attributor(a("<input />"),b);(j.val()===g||h.text===g)&&j.attr("checked",!0);a("<label />",{text:h.text}).append(j).insertAfter(a(c))}})();a(c).remove()}}},addInputType:function(c,b){a.editableSet.types[c]=b}};a.fn.editableSet.defaults={event:"dblclick",action:"/",beforeLoad:a.noop,afterLoad:a.noop,onCancel:a.noop,onSave:a.noop,afterSave:a.noop,onError:a.noop,titleElement:!1,globalSave:!1,dataType:"script",repopulate:function(c,
b,d){a.each(c,function(c,e){var f=a(e).attr("data-name"),h={};if(f){var j=d.model||f.substr(0,f.indexOf("[")),o=f.replace(/\]\[|\[|\]/g,"_").replace(j,"").replace(/^_+|_+$/g,""),m=o.split(/\d+_/).join("").split(/_attributes_/);if(m.length>1){var l;a.each(m,function(a,b){a<m.length-1&&((l=o.match(RegExp(b+"_attributes_(\\d+)")))&&(l=l[1]),h[b]=l||!1)})}var n=m.pop(),i=b[j]||b,k;a.isEmptyObject(h)?k=i[n]:function(){for(var a in h)i=i[a],h[a]&&(i=i[h[a]]),typeof i!=="undefined"&&typeof i[n]!=="undefined"&&
(k=i[n])}();typeof k!==void 0&&(spanObj=a(e),spanObj.attr("data-type")=="textarea"?spanObj.html(a.htmlEncode(k).replace(/(\r\n|[\r\n])/g,"<br />")):spanObj.text(k))}})}};a.fn.editableSet.globals={reversions:[]}})(jQuery);function _ajax_request(a,c,b,d,g,e){jQuery.isFunction(c)&&(b=c,c={});return jQuery.ajax({type:g,url:a,data:c,success:b,dataType:d,error:e})}
jQuery.extend({put:function(a,c,b,d,g){return _ajax_request(a,c,b,d,"PUT",g)},delete_:function(a,c,b,d,g){return _ajax_request(a,c,b,d,"DELETE",g)}});jQuery.extend({htmlEncode:function(a){return $("<div/>").text(a).html()},htmlDecode:function(a){return $("<div/>").html(a).text()}});